/*  "Unofficial" NodeList API Implementation
 *  (c) 2010 John-David Dalton <john@fusejs.com>
 *  John Resig's site: http://nodelist.org/
 *
 *  Fuse JavaScript framework, version Alpha
 *  (c) 2008-2010 John-David Dalton
 *  http://www.fusejs.com/
 *
 *  Both "Unofficial" NodeList and FuseJS are released under the MIT license.
 */
(function(m,bf){var x,J,F=1,B=2,K=3,V=function(a){return a},L='NodeList is not mutable.',bg={'boolean':1,'number':1,'string':1,'undefined':1},y=[],bh=1,i=m.document,M=i.documentElement,N=V,bi=/(?:NodeList|HTMLCollection|Object)/,bj=[].slice,O={}.toString,j='uid'+(new Date).getTime(),W=function(h,f){f||(f={});f.data=f;f.self=h;return function(a,b,c){var d=null;if(a===j){d=f.self;if(b){if(c!==bf){f[b]=c}else{d=f[b]}}}return d}},G=function(a,b,c){var d=b.split(',');while(b=d.shift()){if(l(i,b)||typeof Array.prototype[b]=='function'){a[b]=c(b)}}},C=function(a,b,c){var d=a._(j,'data');c.mutable=d.mutable;b._||(b._=W(b,c));if(d.self!=a){b=b.secure()}b.parentNodeList=a;return b},X=function(a,b){var c=a.length,d=b.length;while(d--)a[c+d]=b[d];return a},D=function(c,d){D=function(a,b){while(b=b[H]){if(b==a)return true}return false};var h=i.createElement('div');if(l(h,'contains')&&h.appendChild(h.cloneNode(h,false))&&h.appendChild(h.cloneNode(h,true))&&!h.firstChild.contains(h.childNodes[1].firstChild)){var f=D;D=function(a,b){return a.nodeName>'@'?a!=b&&a.contains(b):f(a,b)}}return D(c,d)},Y=function(a,b){var c=-1;b||(b=[]);while(b[++c]=a[c]){}return b.length--&&b},bk=function(a){var b;if(z(a)){do{if(!(b=a[H])){return a}}while(a=b)}return i},r=function(c){r=[].indexOf;if(typeof r!='function'){r=function(a){var b=this.length;while(b--){if(this[b]===a)return b}return-1}}return r(c)},z=function(b){if(Z){z=function(a){return(i.compareDocumentPosition(a)&1)==1}}else if(ba){z=function(a){return a.ownerDocument.all[a.sourceIndex]!=a}}else{z=function(a){return!(a[H]&&D(a.ownerDocument,a))}}return z(b)},E=function(a){return O.call(a)=='[object Function]'},l=function l(a,b){var c=typeof a[b];return c=='object'?!!a[b]:!bg[c]},bb=function(a){return a&&(!O.call(a).indexOf('[object HTML')||typeof a.nodeType=='number')},bc=function(a){return a&&bi.test(O.call(a))&&'item'in a},bl=function(a){return a&&(a.nodeName>'@'||a.nodeType==3)&&a.ownerDocument==i},P=function(c){N=P=function(a){var b=y[y.length-1];b.parentNode.removeChild(b);return a};P(c);if(c().constructor==m.Array){if(Q){s(F)}else if(R){s(B)}y.pop();return bd()}return c},s=function(a){N=(J=a)==K?P:V},S=function(t){var o=function(a,b){while(b=b.previousSibling){if(b==a)return-1}return 1},q=function(a){var b,c,d,h,f,k,p=[],n=-1;while(a){++n;d=a[H];while(a=a.previousSibling){++n;h=-1;b=a.childNodes;while((p=[b[++h]])[0]){while(p.length){f=-1;c=[];while(descendant=p[++f]){++n;k=-1;descendants=descendant.childNodes;while(descendant=descendants[++k]){c.push(descendant)}}p=c}}}a=d}return n},g=function(a,b){return q(b)<q(a)?1:-1};if(Z){g=function(a,b){return a.compareDocumentPosition(b)&2?1:-1}}else if(ba){g=function(a,b){var c=a.nodeType==1,d=b.nodeType==1,h=(c?a:a.parentNode).sourceIndex,f=(d?b:b.parentNode).sourceIndex;if(c&&d){return f<h?1:-1}if(c&&!d){return f<h?o(a,b):-1}if(!c&&d){return h<f?-1*o(b,a):1}if(h!=f){return f<h?1:-1}return o(a,b)}}S=function(a){a.sort(g);return a};return S(t)},Q=!!(function(){try{return new ActiveXObject('htmlfile')}catch(e){}})(),Z=l(i,'compareDocumentPosition'),bm=l(i,'createElement')&&l(m,'frames')&&'src'in i.createElement('iframe'),R=(function(){var a,b=[],c=b['__proto__'];if(b['__proto__']==Array.prototype){b['__proto__']={};a=typeof b.push=='undefined';b['__proto__']=c}return!!a&&E(b.push)})(),ba=(function(a){return l(i,'all')&&typeof(a=i.createElement('div')).sourceIndex=='number'&&a.appendChild(a.cloneNode(false)).sourceIndex>-1})(),T=l(i,'matchesSelectors')&&'matchesSelectors'||l(i,'mozMatchesSelector')&&'mozMatchesSelector'||l(i,'msieMatchesSelector')&&'msieMatchesSelector'||l(i,'webkitMatchesSelector')&&'webkitMatchesSelector',H=l('parentElement',M)?'parentElement':'parentNode',bd=function(){var t=U(),o=J==B,q=t.Array().constructor!=m.Array,g=o&&new t.Array||t.Array.prototype,u=t.Array,be=g.concat,bn=g.indexOf,bo=g.lastIndexOf,bp=g.push,bq=g.reverse,v=g.slice,br=g.splice,bs=g.filter,bt=m.Array().map,w=function(a){var b=arguments.length;if(b){return b==1&&typeof a=='number'?new u(a):A(arguments)}return new u},A=function(a){var b=new u;bp.apply(b,a);return b};if(q){w=u;A=function(a){return v.call(a,0)}}else if(o){w=function(a){var b=[],c=arguments.length;if(c){if(c==1&&typeof a=='number'){b.length=a}else{b.push.apply(b,arguments)}}b.__proto__=g;return b};A=function(a){var b=v.call(a,0);b['__proto__']=g;return b}}g.createNodeList=I;g.concat=function(){var a=v.call(arguments,0),b=a.length,c=-1;while(++c<b){if(bc(a[c])){a[c]=Y(a[c])}else if(bb(a[c])){a[c]=a[c]}else if(a[c].constructor==x){a[c]=v.call(a[c]._(j),0)}else{a[c]=v.call(a[c],0)}}return I.call(this,be.apply(this._(j),a),{'callerName':'concat','callerArgs':arguments})};g.item=function(a){return a>-1&&a<this.length?this[a]:null};g.requery=function(){var a=this._(j,'data'),b=this.parentNodeList;return a.mutable?this.slice(0):this[a.callerName].apply(b&&b.requery()||this,a.callerArgs||[])};g.reverse=function(){return C(this,this.length>0?A(bq.call(this)):w(),{'callerName':'reverse'})};g.secure=function(){var a=this,b=a,c=a.length;if(a._(j)==a){b=x();while(c--)b[c]=null;b.parentNodeList=null;b._=a._}return b};g.slice=function(a,b){var c=this._(j),d=b==null?v.call(c,a):v.call(c,a,b);return C(this,q?d:A(d),{'callerName':'slice','callerArgs':[a,b]})};g.splice=function(a,b){var c=this._(j,'data');if(c.self!=this){throw new Error(L);}c.mutable=true;return i.createNodeList(br.apply(c.self,arguments))};g.toArray=function(){return bj.call(this,0)};G(g,'querySelectorAll,queryScopedSelectorAll',function(k){return function(a){var b,c=-1,d=this._(j),h=d.length,f=[];while(++c<h){if(c in d&&(b=d[c][k](a)).length)X(f,b)}return this.createNodeList(f,{'callerName':k,'callerArgs':[a]})}});G(g,'addEventListener,removeEventListener,dispatchEvent',function(k){return function(a,b,c){var d=this._(j),h=d.length,f=-1;if(b){while(++f<h)f in d&&d[f][k](a,b,c)}else{while(++f<h)f in d&&d[f][k](a)}return this}});G(g,'push,unshift',function(p){var n=g[p];return function(){var a,b=[],c=-1,d=c,h=this._(j,'data'),f=arguments.length,k=h.self;if(k!=this){throw new Error(L);}while(++c<f){a=arguments[c];if(bb(a)&&r.call(k,a)<0){b[++d]=a}}h.mutable=true;return n.apply(this,b)}});G(g,'pop,shift',function(b){var c=g[b];return function(){var a=this._(j,'data');if(a.self!=this)throw new Error(L);a.mutable=true;return c.call(this)}});if(E(g.filter)){g.filter=function(c,d){var h,f=c,k=this._(j),p=this;if(k!=p){c=function(a,b){return f.call(this,null,b,p)};if(typeof f!='function'){throw new TypeError;}}h=bs.call(k,c,d);return C(this,q?h:A(h),{'callerName':'filter','callerArgs':[c,d]})}}if(E(g.indexOf)){g.indexOf=function(a){return bn.call(this._(j),a)}}if(E(g.lastIndexOf)){g.lastIndexOf=function(a){return bo.call(this._(j),a)}}if(E(g.map)){g.map=function(a,b){return I.call(this,bt.call(this,a,b),{'callerName':'map','callerArgs':[a,b]})}}if(T){g.filterSelector=function(a){var b=this._(j),c=-1,d=c,h=b.length,f=w();while(++c<h){if(c in b&&b[c][T]())f[++d]=b[c]}return C(this,f,{'callerName':'filterSelector','callerArgs':[a]})};g.matchesSelector=function(a){var b=this._(j),c=b.length,d=-1;while(++d<c){if(d in b&&b[d][T]())return true}return false}}(w.prototype=g).constructor=w;return N(w)},I=function(a,b){var c,d,h,f,k,p=bc(a),n=x(),t=this,o=[],q=[],g=-1,u=g,be=g;if(arguments.length>0&&(!a||typeof a!='object'&&!p)){throw new Error('Incorrect argument: '+a+' '+(typeof a));}b||(b={'callerName':'createNodeList','callerArgs':[a]});if(p){Y(a,n);b.mutable=false}else if(a){if(a.constructor==x){k=a._(j,'data');b.mutable=k.mutable;a=k.self.toArray()}else{b.mutable=true}h=a.length>>>0;while(++g<h){if(bl(node=a[g])){if(z(node)){if((d=r.call(q,root=bk(node)))<0){o[d=q.push(root)-1]=[]}}else{if((d=c)==null){o[d=c=q.push(i)-1]=[]}}if(r.call(o[d],node)<0){o[d].push(node)}}}h=o.length;while(++u<h){X(n,S(o[u]))}}if(this.constructor==x){n=C(this,n,b)}else{n._=W(n,b);n.parentNodeList=null}return n},U=function(){var a,b,c,d,h,f;switch(J){case B:return m;case F:f=new ActiveXObject('htmlfile');f.write('<script><\/script>');f.close();y.push(f);if(l(m,'attachEvent')){m.attachEvent('onunload',function(){y.length=0})}return f.parentWindow;case K:b='/* fusebox_iframe_cache_fix */';c=j+bh++;d=i.body||M;try{a=i.createElement('<iframe name="'+c+'">')}catch(e){(a=i.createElement('iframe')).name=c}try{if('MozOpacity'in M.style&&l(m,'sessionStorage')&&!m.sessionStorage[b]){m.sessionStorage[b]=1;throw new Error;}a.style.display='none';d.insertBefore(a,d.firstChild);h=m.frames[c];f=h.document;f.write('<script>var g=this,c=function(s){(s=g.frameElement.src)&&g.location.replace(s);if(g.parent.document.readyState!="complete"){g.setTimeout(c,10)}};c()<\/script>');f.close();y.push(a);return h}catch(e){if(Q){s(F);return U()}if(R){s(B);return U()}throw new Error('Fusebox failed to create a sandbox by iframe.');}}throw new Error('Fusebox failed to create a sandbox.');};if(l(i,'createNodeList')){return}if(typeof i.readyState!='string'&&l(i,'addEventListener')){i.readyState='loading';i.addEventListener('DOMContentLoaded',function(){i.readyState='interactive'},true);m.addEventListener('load',function(){i.readyState='complete'},true)}if(Q&&!l(m,'XMLHttpRequest')&&m.location&&m.location.protocol=='https:'){s(F)}else if(bm){s(K)}else if(R){s(B)}x=bd();i.createNodeList=I})(this);