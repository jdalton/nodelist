/*  "Unofficial" NodeList API Implementation
 *  (c) 2010 John-David Dalton <john@fusejs.com>
 *  http://github.com/jdalton/nodelist
 *
 *  Fuse JavaScript framework, version Alpha
 *  (c) 2008-2010 John-David Dalton
 *  http://www.fusejs.com/
 *
 *  "Unofficial" NodeList and FuseJS are released under the MIT license.
 */
(function(p,bf){var w,J,G=1,B=2,K=3,W=function(a){return a},L='NodeList is not mutable.',bg={'boolean':1,'number':1,'string':1,'undefined':1},x=[],bh=1,i=p.document,M=i.documentElement,N=W,bi=/(?:NodeList|HTMLCollection|Object)/,bj=[].slice,O={}.toString,j='uid'+(new Date).getTime(),X=function(g,f){f||(f={});f.data=f;f.self=g;g._=function(a,b,c){var d=null;if(a===j){d=f.self;if(b){if(c!==bf){f[b]=c}else{d=f[b]}}}return d}},H=function(a,b,c){var d=b.split(',');while(b=d.shift()){if(k(i,b)||typeof Array.prototype[b]=='function'){a[b]=c(b)}}},C=function(a,b,c){var d=a._(j,'data');if(!(c.requeryable=d.requeryable)){s(c)}b._||X(b,c);if(d.self!=a){b=b.secure()}b.parentNodeList=a;return b},Y=function(a,b){var c=a.length,d=b.length;while(d--)a[c+d]=b[d];return a},D=function(c,d){D=function(a,b){while(b=b[I]){if(b==a)return true}return false};var g=i.createElement('div');if(k(g,'contains')&&g.appendChild(g.cloneNode(g,false))&&g.appendChild(g.cloneNode(g,true))&&!g.firstChild.contains(g.childNodes[1].firstChild)){var f=D;D=function(a,b){return a.nodeName>'@'?a!=b&&a.contains(b):f(a,b)}}return D(c,d)},Z=function(a,b){var c=[],d=a.length,g=--b||-1,f=g;while(++g<d){if(ba(a[g])){c[++f]=a[g]}}return c},bk=function(a){var b;if(y(a)){do{if(!(b=a[I])){return a}}while(a=b)}return i},z=function(c){z=[].indexOf;if(typeof z!='function'){z=function(a){var b=this.length;while(b--){if(this[b]===a)return b}return-1}}return z(c)},y=function(b){if(bb){y=function(a){return(i.compareDocumentPosition(a)&1)==1}}else if(bc){y=function(a){return a.ownerDocument.all[a.sourceIndex]!=a}}else{y=function(a){return!(a[I]&&D(a.ownerDocument,a))}}return y(b)},E=function(a){return O.call(a)=='[object Function]'},k=function k(a,b){var c=typeof a[b];return c=='object'?!!a[b]:!bg[c]},ba=function(a){return a&&(!O.call(a).indexOf('[object HTML')||typeof a.nodeType=='number')},bd=function(a){return a&&bi.test(O.call(a))&&'item'in a},bl=function(a){return a&&(a.nodeName>'@'||a.nodeType==3)&&a.ownerDocument==i},P=function(c){N=P=function(a){var b=x[x.length-1];b.parentNode.removeChild(b);return a};P(c);if(c().constructor==p.Array){if(Q){t(G)}else if(R){t(B)}x.pop();return be()}return c},t=function(a){N=(J=a)==K?P:W},S=function(q){var o=function(a,b){while(b=b.previousSibling){if(b==a)return-1}return 1},h=function(a){var b,c,d,g,f,l,m=[],n=-1;while(a){++n;d=a[I];while(a=a.previousSibling){++n;g=-1;b=a.childNodes;while((m=[b[++g]])[0]){while(m.length){f=-1;c=[];while(descendant=m[++f]){++n;l=-1;descendants=descendant.childNodes;while(descendant=descendants[++l]){c.push(descendant)}}m=c}}}a=d}return n},r=function(a,b){return h(b)<h(a)?1:-1};if(bb){r=function(a,b){return a.compareDocumentPosition(b)&2?1:-1}}else if(bc){r=function(a,b){var c=a.nodeType==1,d=b.nodeType==1,g=(c?a:a.parentNode).sourceIndex,f=(d?b:b.parentNode).sourceIndex;if(c&&d){return f<g?1:-1}if(c&&!d){return f<g?o(a,b):-1}if(!c&&d){return g<f?-1*o(b,a):1}if(g!=f){return f<g?1:-1}return o(a,b)}}S=function(a){a.sort(r);return a};return S(q)},s=function(a){delete a.callerArgs;delete a.callerName;delete a.requeryable;delete a.snapshot},Q=!!(function(){try{return new ActiveXObject('htmlfile')}catch(e){}})(),bb=k(i,'compareDocumentPosition'),bm=k(i,'createElement')&&k(p,'frames')&&'src'in i.createElement('iframe'),R=(function(){var a,b=[],c=b['__proto__'];if(b['__proto__']==Array.prototype){b['__proto__']={};a=typeof b.push=='undefined';b['__proto__']=c}return!!a&&E(b.push)})(),bc=(function(a){return k(i,'all')&&typeof(a=i.createElement('div')).sourceIndex=='number'&&a.appendChild(a.cloneNode(false)).sourceIndex>-1})(),T=k(i,'matchesSelectors')&&'matchesSelectors'||k(i,'mozMatchesSelector')&&'mozMatchesSelector'||k(i,'msieMatchesSelector')&&'msieMatchesSelector'||k(i,'webkitMatchesSelector')&&'webkitMatchesSelector',I=k('parentElement',M)?'parentElement':'parentNode',be=function(){var n=U(),q=J==B,o=n.Array().constructor!=p.Array,h=q&&new n.Array||n.Array.prototype,r=n.Array,bn=h.concat,bo=h.indexOf,bp=h.lastIndexOf,bq=h.push,br=h.reverse,u=h.slice,bs=h.splice,bt=h.filter,bu=p.Array().map,v=function(a){var b=arguments.length;if(b){return b==1&&typeof a=='number'?new r(a):A(arguments)}return new r},A=function(a){var b=new r;bq.apply(b,a);return b};if(o){v=r;A=function(a){return u.call(a,0)}}else if(q){v=function(a){var b=[],c=arguments.length;if(c){if(c==1&&typeof a=='number'){b.length=a}else{b.push.apply(b,arguments)}}b.__proto__=h;return b};A=function(a){var b=u.call(a,0);b['__proto__']=h;return b}}h.createNodeList=V;h.concat=function(){var a,b=u.call(arguments,0),c=b.length,d=-1,g=d;while(++d<c){if(bd(b[d])){a=[];while(a[++g]=b[d][g]){}b[d]=a.length--&&a}else if(ba(b[d])){b[d]=b[d]}else if(b[d].constructor==w){b[d]=u.call(b[d]._(j),0)}else{b[d]=u.call(b[d],0)}}return F(this,bn.apply(this._(j),b),{'callerName':'concat','callerArgs':arguments})};h.item=function(a){return a>-1&&a<this.length?this[a]:null};h.requery=function(){var a=this._(j,'data'),b=this.length,c=this.parentNodeList,d=a.snapshot;if(d){if(d.length!=b){s(a)}else{while(b--){if(this[b]!=d[b]){s(a);break}}}}return a.requeryable?this[a.callerName].apply(c&&c.requery()||this,a.callerArgs||[]):this.slice(0)};h.reverse=function(){return C(this,this.length>0?A(br.call(this)):v(),{'callerName':'reverse'})};h.secure=function(){var a=this,b=a,c=a.length;if(a._(j)==a){b=w();while(c--)b[c]=null;b.parentNodeList=null;b._=a._}return b};h.slice=function(a,b){var c=this._(j),d=b==null?u.call(c,a):u.call(c,a,b);return C(this,o?d:A(d),{'callerName':'slice','callerArgs':[a,b]})};h.splice=function(a,b){var c,d=this._(j,'data');if(d.self!=this){throw new Error(L);}if(d.requeryable){s(d)}return F(null,c=bs.apply(d.self,Z(arguments,2)),{'callerName':'createNodeList','callerArgs':[c]},true)};h.toArray=function(){return bj.call(this,0)};H(h,'querySelectorAll,queryScopedSelectorAll',function(l){return function(a){var b,c=-1,d=this._(j),g=d.length,f=[];while(++c<g){if(c in d&&(b=d[c][l](a)).length)Y(f,b)}return F(this,f,{'callerName':l,'callerArgs':[a]},true)}});H(h,'addEventListener,removeEventListener,dispatchEvent',function(l){return function(a,b,c){var d=this._(j),g=d.length,f=-1;if(b){while(++f<g)f in d&&d[f][l](a,b,c)}else{while(++f<g)f in d&&d[f][l](a)}return this}});H(h,'push,unshift',function(b){var c=h[b];return function(){var a=this._(j,'data');if(a.self!=this){throw new Error(L);}if(a.requeryable){s(a)}return c.apply(this,Z(arguments))}});H(h,'pop,shift',function(b){var c=h[b];return function(){var a=this._(j,'data');if(a.self!=this){throw new Error(L);}if(a.requeryable){s(a)}return c.call(this)}});if(E(h.filter)){h.filter=function(c,d){var g,f=c,l=this._(j),m=this;if(l!=m){c=function(a,b){return f.call(this,null,b,m)};if(typeof f!='function'){throw new TypeError;}}g=bt.call(l,c,d);return C(this,o?g:A(g),{'callerName':'filter','callerArgs':[c,d]})}}if(E(h.indexOf)){h.indexOf=function(a){return bo.call(this._(j),a)}}if(E(h.lastIndexOf)){h.lastIndexOf=function(a){return bp.call(this._(j),a)}}if(E(h.map)){h.map=function(a,b){return F(this,bu.call(this,a,b),{'callerName':'map','callerArgs':[a,b]})}}if(T){h.filterSelector=function(a){var b=this._(j),c=-1,d=c,g=b.length,f=v();while(++c<g){if(c in b&&b[c][T]())f[++d]=b[c]}return C(this,f,{'callerName':'filterSelector','callerArgs':[a]})};h.matchesSelector=function(a){var b=this._(j),c=b.length,d=-1;while(++d<c){if(d in b&&b[d][T]())return true}return false}}(v.prototype=h).constructor=v;return N(v)},F=function(a,b,c,d){var g,f,l,m=w(),n=[],q=[],o=-1,h=o,r=o;c||(c={});if(d){while(m[++o]=q[o]=b[o]){}m.length=--q.length;c.snapshot=q;c.requeryable=true}else if(b){if(b.constructor==w&&b._){c.requeryable=b._(j,'requeryable');b=b.toArray()}l=b.length>>>0;while(++o<l){if(bl(node=b[o])){if(y(node)){if((f=z.call(q,root=bk(node)))<0){n[f=q.push(root)-1]=[]}}else{if((f=g)==null){n[f=g=q.push(i)-1]=[]}}if(z.call(n[f],node)<0){n[f].push(node)}}}l=n.length;while(++h<l){Y(m,S(n[h]))}}if(a&&a.constructor==w){m=C(a,m,c)}else{X(m,c);if(!c.requeryable){s(c)}m.parentNodeList=null}return m},V=function V(a){var b=bd(a);if(arguments.length>0&&(!a||typeof a!='object'&&!b)){throw new Error('Incorrect argument: '+a+' '+typeof a);}return F(this,a,{'callerName':'createNodeList','callerArgs':[a]},b)},U=function(){var a,b,c,d,g,f;switch(J){case B:return p;case G:f=new ActiveXObject('htmlfile');f.write('<script><\/script>');f.close();x.push(f);if(k(p,'attachEvent')){attachEvent('onunload',function(){x.length=0})}return f.parentWindow;case K:b='/* fuse_iframe_cache_fix */';c=j+bh++;d=i.body||M;try{a=i.createElement('<iframe name="'+c+'">')}catch(e){(a=i.createElement('iframe')).name=c}try{if('MozOpacity'in M.style&&k(p,'sessionStorage')&&!sessionStorage[b]){sessionStorage[b]=1;throw new Error;}a.style.display='none';d.insertBefore(a,d.firstChild);g=p.frames[c];f=g.document;f.write('<script>var c=function(s){(s=frameElement.src)&&location.replace(s);if(parent.document.readyState!="complete"){setTimeout(c,10)}};c()<\/script>');f.close();x.push(a);return g}catch(e){if(Q){t(G);return U()}if(R){t(B);return U()}throw new Error('Fusebox failed to create a sandbox by iframe.');}}throw new Error('Fusebox failed to create a sandbox.');};if(k(i,'createNodeList')){return}if(typeof i.readyState!='string'&&k(i,'addEventListener')){i.readyState='loading';i.addEventListener('DOMContentLoaded',function(){i.readyState='interactive'},true);addEventListener('load',function(){i.readyState='complete'},true)}if(Q&&!k(p,'XMLHttpRequest')&&p.location&&location.protocol=='https:'){t(G)}else if(bm){t(K)}else if(R){t(B)}w=be();i.createNodeList=V})(this);