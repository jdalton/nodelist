/*  "Unofficial" NodeList API Implementation
 *  (c) 2010 John-David Dalton <john@fusejs.com>
 *  John Resig's site: http://nodelist.org/
 *
 *  Fuse JavaScript framework, version Alpha
 *  (c) 2008-2010 John-David Dalton
 *  http://www.fusejs.com/
 *
 *  Both "Unofficial" NodeList and FuseJS are released under the MIT license.
 */
(function(m,bg){var x,J,G=1,B=2,K=3,W=function(a){return a},L='NodeList is not mutable.',bh={'boolean':1,'number':1,'string':1,'undefined':1},y=[],bi=1,i=m.document,M=i.documentElement,N=W,bj=/(?:NodeList|HTMLCollection|Object)/,bk=[].slice,O={}.toString,j='uid'+(new Date).getTime(),X=function(h,f){f||(f={});f.data=f;f.self=h;h._=function(a,b,c){var d=null;if(a===j){d=f.self;if(b){if(c!==bg){f[b]=c}else{d=f[b]}}}return d}},H=function(a,b,c){var d=b.split(',');while(b=d.shift()){if(l(i,b)||typeof Array.prototype[b]=='function'){a[b]=c(b)}}},C=function(a,b,c){var d=a._(j,'data');c.requeryable=d.requeryable;b._||X(b,c);if(d.self!=a){b=b.secure()}b.parentNodeList=a;return b},Y=function(a,b){var c=a.length,d=b.length;while(d--)a[c+d]=b[d];return a},D=function(c,d){D=function(a,b){while(b=b[I]){if(b==a)return true}return false};var h=i.createElement('div');if(l(h,'contains')&&h.appendChild(h.cloneNode(h,false))&&h.appendChild(h.cloneNode(h,true))&&!h.firstChild.contains(h.childNodes[1].firstChild)){var f=D;D=function(a,b){return a.nodeName>'@'?a!=b&&a.contains(b):f(a,b)}}return D(c,d)},Z=function(a,b){var c=-1;b||(b=[]);while(b[++c]=a[c]){}return b.length--&&b},bl=function(a){var b;if(z(a)){do{if(!(b=a[I])){return a}}while(a=b)}return i},s=function(c){s=[].indexOf;if(typeof s!='function'){s=function(a){var b=this.length;while(b--){if(this[b]===a)return b}return-1}}return s(c)},z=function(b){if(ba){z=function(a){return(i.compareDocumentPosition(a)&1)==1}}else if(bb){z=function(a){return a.ownerDocument.all[a.sourceIndex]!=a}}else{z=function(a){return!(a[I]&&D(a.ownerDocument,a))}}return z(b)},E=function(a){return O.call(a)=='[object Function]'},l=function l(a,b){var c=typeof a[b];return c=='object'?!!a[b]:!bh[c]},bc=function(a){return a&&(!O.call(a).indexOf('[object HTML')||typeof a.nodeType=='number')},bd=function(a){return a&&bj.test(O.call(a))&&'item'in a},bm=function(a){return a&&(a.nodeName>'@'||a.nodeType==3)&&a.ownerDocument==i},P=function(c){N=P=function(a){var b=y[y.length-1];b.parentNode.removeChild(b);return a};P(c);if(c().constructor==m.Array){if(Q){t(G)}else if(R){t(B)}y.pop();return be()}return c},t=function(a){N=(J=a)==K?P:W},S=function(n){var o=function(a,b){while(b=b.previousSibling){if(b==a)return-1}return 1},p=function(a){var b,c,d,h,f,k,q=[],r=-1;while(a){++r;d=a[I];while(a=a.previousSibling){++r;h=-1;b=a.childNodes;while((q=[b[++h]])[0]){while(q.length){f=-1;c=[];while(descendant=q[++f]){++r;k=-1;descendants=descendant.childNodes;while(descendant=descendants[++k]){c.push(descendant)}}q=c}}}a=d}return r},g=function(a,b){return p(b)<p(a)?1:-1};if(ba){g=function(a,b){return a.compareDocumentPosition(b)&2?1:-1}}else if(bb){g=function(a,b){var c=a.nodeType==1,d=b.nodeType==1,h=(c?a:a.parentNode).sourceIndex,f=(d?b:b.parentNode).sourceIndex;if(c&&d){return f<h?1:-1}if(c&&!d){return f<h?o(a,b):-1}if(!c&&d){return h<f?-1*o(b,a):1}if(h!=f){return f<h?1:-1}return o(a,b)}}S=function(a){a.sort(g);return a};return S(n)},Q=!!(function(){try{return new ActiveXObject('htmlfile')}catch(e){}})(),ba=l(i,'compareDocumentPosition'),bn=l(i,'createElement')&&l(m,'frames')&&'src'in i.createElement('iframe'),R=(function(){var a,b=[],c=b['__proto__'];if(b['__proto__']==Array.prototype){b['__proto__']={};a=typeof b.push=='undefined';b['__proto__']=c}return!!a&&E(b.push)})(),bb=(function(a){return l(i,'all')&&typeof(a=i.createElement('div')).sourceIndex=='number'&&a.appendChild(a.cloneNode(false)).sourceIndex>-1})(),T=l(i,'matchesSelectors')&&'matchesSelectors'||l(i,'mozMatchesSelector')&&'mozMatchesSelector'||l(i,'msieMatchesSelector')&&'msieMatchesSelector'||l(i,'webkitMatchesSelector')&&'webkitMatchesSelector',I=l('parentElement',M)?'parentElement':'parentNode',be=function(){var n=U(),o=J==B,p=n.Array().constructor!=m.Array,g=o&&new n.Array||n.Array.prototype,u=n.Array,bf=g.concat,bo=g.indexOf,bp=g.lastIndexOf,bq=g.push,br=g.reverse,v=g.slice,bs=g.splice,bt=g.filter,bu=m.Array().map,w=function(a){var b=arguments.length;if(b){return b==1&&typeof a=='number'?new u(a):A(arguments)}return new u},A=function(a){var b=new u;bq.apply(b,a);return b};if(p){w=u;A=function(a){return v.call(a,0)}}else if(o){w=function(a){var b=[],c=arguments.length;if(c){if(c==1&&typeof a=='number'){b.length=a}else{b.push.apply(b,arguments)}}b.__proto__=g;return b};A=function(a){var b=v.call(a,0);b['__proto__']=g;return b}}g.createNodeList=V;g.concat=function(){var a=v.call(arguments,0),b=a.length,c=-1;while(++c<b){if(bd(a[c])){a[c]=Z(a[c])}else if(bc(a[c])){a[c]=a[c]}else if(a[c].constructor==x){a[c]=v.call(a[c]._(j),0)}else{a[c]=v.call(a[c],0)}}return F(this,bf.apply(this._(j),a),{'callerName':'concat','callerArgs':arguments})};g.item=function(a){return a>-1&&a<this.length?this[a]:null};g.requery=function(){var a=this._(j,'data'),b=this.parentNodeList;return a.requeryable?this[a.callerName].apply(b&&b.requery()||this,a.callerArgs||[]):this.slice(0)};g.reverse=function(){return C(this,this.length>0?A(br.call(this)):w(),{'callerName':'reverse'})};g.secure=function(){var a=this,b=a,c=a.length;if(a._(j)==a){b=x();while(c--)b[c]=null;b.parentNodeList=null;b._=a._}return b};g.slice=function(a,b){var c=this._(j),d=b==null?v.call(c,a):v.call(c,a,b);return C(this,p?d:A(d),{'callerName':'slice','callerArgs':[a,b]})};g.splice=function(a,b){var c,d=this._(j,'data');if(d.self!=this){throw new Error(L);}d.requeryable=false;return F(null,c=bs.apply(d.self,arguments),{'callerName':'createNodeList','callerArgs':[c]},true)};g.toArray=function(){return bk.call(this,0)};H(g,'querySelectorAll,queryScopedSelectorAll',function(k){return function(a){var b,c=-1,d=this._(j),h=d.length,f=[];while(++c<h){if(c in d&&(b=d[c][k](a)).length)Y(f,b)}return F(this,f,{'callerName':k,'callerArgs':[a]},true)}});H(g,'addEventListener,removeEventListener,dispatchEvent',function(k){return function(a,b,c){var d=this._(j),h=d.length,f=-1;if(b){while(++f<h)f in d&&d[f][k](a,b,c)}else{while(++f<h)f in d&&d[f][k](a)}return this}});H(g,'push,unshift',function(q){var r=g[q];return function(){var a,b=[],c=-1,d=c,h=this._(j,'data'),f=arguments.length,k=h.self;if(k!=this){throw new Error(L);}while(++c<f){a=arguments[c];if(bc(a)&&s.call(k,a)<0){b[++d]=a}}h.requeryable=false;return r.apply(this,b)}});H(g,'pop,shift',function(b){var c=g[b];return function(){var a=this._(j,'data');if(a.self!=this)throw new Error(L);a.requeryable=false;return c.call(this)}});if(E(g.filter)){g.filter=function(c,d){var h,f=c,k=this._(j),q=this;if(k!=q){c=function(a,b){return f.call(this,null,b,q)};if(typeof f!='function'){throw new TypeError;}}h=bt.call(k,c,d);return C(this,p?h:A(h),{'callerName':'filter','callerArgs':[c,d]})}}if(E(g.indexOf)){g.indexOf=function(a){return bo.call(this._(j),a)}}if(E(g.lastIndexOf)){g.lastIndexOf=function(a){return bp.call(this._(j),a)}}if(E(g.map)){g.map=function(a,b){return F(this,bu.call(this,a,b),{'callerName':'map','callerArgs':[a,b]})}}if(T){g.filterSelector=function(a){var b=this._(j),c=-1,d=c,h=b.length,f=w();while(++c<h){if(c in b&&b[c][T]())f[++d]=b[c]}return C(this,f,{'callerName':'filterSelector','callerArgs':[a]})};g.matchesSelector=function(a){var b=this._(j),c=b.length,d=-1;while(++d<c){if(d in b&&b[d][T]())return true}return false}}(w.prototype=g).constructor=w;return N(w)},F=function(a,b,c,d){var h,f,k,q,r,n=x(),o=[],p=[],g=-1,u=g,bf=g;c||(c={});if(d){Z(b,n);c.requeryable=true}else if(b){if(b.constructor==x&&b._){r=b._(j,'data');c.requeryable=r.requeryable;b=r.self.toArray()}else{c.requeryable=false}k=b.length>>>0;while(++g<k){if(bm(node=b[g])){if(z(node)){if((f=s.call(p,root=bl(node)))<0){o[f=p.push(root)-1]=[]}}else{if((f=h)==null){o[f=h=p.push(i)-1]=[]}}if(s.call(o[f],node)<0){o[f].push(node)}}}k=o.length;while(++u<k){Y(n,S(o[u]))}}if(a&&a.constructor==x){n=C(a,n,c)}else{X(n,c);n.parentNodeList=null}return n},V=function V(a){var b=bd(a);if(arguments.length>0&&(!a||typeof a!='object'&&!b)){throw new Error('Incorrect argument: '+a+' '+typeof a);}return F(this,a,{'callerName':'createNodeList','callerArgs':[a]},b)},U=function(){var a,b,c,d,h,f;switch(J){case B:return m;case G:f=new ActiveXObject('htmlfile');f.write('<script><\/script>');f.close();y.push(f);if(l(m,'attachEvent')){m.attachEvent('onunload',function(){y.length=0})}return f.parentWindow;case K:b='/* fusebox_iframe_cache_fix */';c=j+bi++;d=i.body||M;try{a=i.createElement('<iframe name="'+c+'">')}catch(e){(a=i.createElement('iframe')).name=c}try{if('MozOpacity'in M.style&&l(m,'sessionStorage')&&!m.sessionStorage[b]){m.sessionStorage[b]=1;throw new Error;}a.style.display='none';d.insertBefore(a,d.firstChild);h=m.frames[c];f=h.document;f.write('<script>var g=this,c=function(s){(s=g.frameElement.src)&&g.location.replace(s);if(g.parent.document.readyState!="complete"){g.setTimeout(c,10)}};c()<\/script>');f.close();y.push(a);return h}catch(e){if(Q){t(G);return U()}if(R){t(B);return U()}throw new Error('Fusebox failed to create a sandbox by iframe.');}}throw new Error('Fusebox failed to create a sandbox.');};if(l(i,'createNodeList')){return}if(typeof i.readyState!='string'&&l(i,'addEventListener')){i.readyState='loading';i.addEventListener('DOMContentLoaded',function(){i.readyState='interactive'},true);m.addEventListener('load',function(){i.readyState='complete'},true)}if(Q&&!l(m,'XMLHttpRequest')&&m.location&&m.location.protocol=='https:'){t(G)}else if(bn){t(K)}else if(R){t(B)}x=be();i.createNodeList=V})(this);