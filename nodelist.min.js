/*  "Unofficial" NodeList API Implementation
 *  (c) 2010 John-David Dalton <john@fusejs.com>
 *  http://github.com/jdalton/nodelist
 *
 *  Fuse JavaScript framework, version Alpha
 *  (c) 2008-2010 John-David Dalton
 *  http://www.fusejs.com/
 *
 *  "Unofficial" NodeList and FuseJS are released under the MIT license.
 */
(function(l,bg){var v,J,F=1,A=2,K=3,W=function(a){return a},L='NodeList is not mutable.',bh={'boolean':1,'number':1,'string':1,'undefined':1},w=[],bi=1,i=l.document,M=i.documentElement,N=W,bj=/(?:NodeList|HTMLCollection|Object)/,bk=[].slice,O={}.toString,j='uid'+(new Date).getTime(),X=function(g,f){f||(f={});f.data=f;f.self=g;g._=function(a,b,c){var d=null;if(a===j){d=f.self;if(b){if(c!==bg){f[b]=c}else{d=f[b]}}}return d}},G=function(a,b,c){var d=b.split(',');while(b=d.shift()){if(k(i,b)||typeof Array.prototype[b]=='function'){a[b]=c(b)}}},B=function(a,b,c){var d=a._(j,'data');b._||X(b,c);if(!d.snapshot){c.snapshot=false}if(d.self!=a){b=b.secure()}b.parentNodeList=a;return b},Y=function(a,b){var c=a.length,d=b.length;while(d--)a[c+d]=b[d];return a},C=function(c,d){C=function(a,b){while(b=b[H]){if(b==a)return true}return false};var g=i.createElement('div');if(k(g,'contains')&&g.appendChild(g.cloneNode(g,false))&&g.appendChild(g.cloneNode(g,true))&&!g.firstChild.contains(g.childNodes[1].firstChild)){var f=C;C=function(a,b){return a.nodeName>'@'?a!=b&&a.contains(b):f(a,b)}}return C(c,d)},Z=function(a,b){var c=[],d=a.length,g=--b||-1,f=g;while(++g<d){if(ba(a[g])){c[++f]=a[g]}}return c},bl=function(a){var b;if(x(a)){do{if(!(b=a[H])){return a}}while(a=b)}return i},y=function(c){y=[].indexOf;if(typeof y!='function'){y=function(a){var b=this.length;while(b--){if(this[b]===a)return b}return-1}}return y(c)},x=function(b){if(bb){x=function(a){return(i.compareDocumentPosition(a)&1)==1}}else if(bc){x=function(a){return a.ownerDocument.all[a.sourceIndex]!=a}}else{x=function(a){return!(a[H]&&C(a.ownerDocument,a))}}return x(b)},D=function(a){return O.call(a)=='[object Function]'},k=function k(a,b){var c=typeof a[b];return c=='object'?!!a[b]:!bh[c]},ba=function(a){return a&&(!O.call(a).indexOf('[object HTML')||typeof a.nodeType=='number')},bd=function(a){return a&&bj.test(O.call(a))&&'item'in a},bm=function(a){return a&&(a.nodeName>'@'||a.nodeType==3)&&a.ownerDocument==i},P=function(c){N=P=function(a){var b=w[w.length-1];b.parentNode.removeChild(b);return a};P(c);if(c().constructor==l.Array){if(Q){s(F)}else if(R){s(A)}w.pop();return be()}return c},s=function(a){N=(J=a)==K?P:W},S=function(p){var o=function(a,b){while(b=b.previousSibling){if(b==a)return-1}return 1},h=function(a){var b,c,d,g,f,m,r=[],q=-1;while(a){++q;d=a[H];while(a=a.previousSibling){++q;g=-1;b=a.childNodes;while((r=[b[++g]])[0]){while(r.length){f=-1;c=[];while(descendant=r[++f]){++q;m=-1;descendants=descendant.childNodes;while(descendant=descendants[++m]){c.push(descendant)}}r=c}}}a=d}return q},n=function(a,b){return h(b)<h(a)?1:-1};if(bb){n=function(a,b){return a.compareDocumentPosition(b)&2?1:-1}}else if(bc){n=function(a,b){var c=a.nodeType==1,d=b.nodeType==1,g=(c?a:a.parentNode).sourceIndex,f=(d?b:b.parentNode).sourceIndex;if(c&&d){return f<g?1:-1}if(c&&!d){return f<g?o(a,b):-1}if(!c&&d){return g<f?-1*o(b,a):1}if(g!=f){return f<g?1:-1}return o(a,b)}}S=function(a){a.sort(n);return a};return S(p)},Q=!!(function(){try{return new ActiveXObject('htmlfile')}catch(e){}})(),bb=k(i,'compareDocumentPosition'),bn=k(i,'createElement')&&k(l,'frames')&&'src'in i.createElement('iframe'),R=(function(){var a,b=[],c=b['__proto__'];if(b['__proto__']==Array.prototype){b['__proto__']={};a=typeof b.push=='undefined';b['__proto__']=c}return!!a&&D(b.push)})(),bc=(function(a){return k(i,'all')&&typeof(a=i.createElement('div')).sourceIndex=='number'&&a.appendChild(a.cloneNode(false)).sourceIndex>-1})(),T=k(i,'matchesSelectors')&&'matchesSelectors'||k(i,'mozMatchesSelector')&&'mozMatchesSelector'||k(i,'msieMatchesSelector')&&'msieMatchesSelector'||k(i,'webkitMatchesSelector')&&'webkitMatchesSelector',H=k('parentElement',M)?'parentElement':'parentNode',be=function(){var q=U(),p=J==A,o=q.Array().constructor!=l.Array,h=p&&new q.Array||q.Array.prototype,n=q.Array,I=h.concat,bf=h.indexOf,bo=h.lastIndexOf,bp=h.push,bq=h.reverse,t=h.slice,br=h.splice,bs=h.filter,bt=l.Array().map,u=function(a){var b=arguments.length;if(b){return b==1&&typeof a=='number'?new n(a):z(arguments)}return new n},z=function(a){var b=new n;bp.apply(b,a);return b};if(o){u=n;z=function(a){return t.call(a,0)}}else if(p){u=function(a){var b=[],c=arguments.length;if(c){if(c==1&&typeof a=='number'){b.length=a}else{b.push.apply(b,arguments)}}b.__proto__=h;return b};z=function(a){var b=t.call(a,0);b['__proto__']=h;return b}}h.createNodeList=V;h.concat=function(){var a,b=t.call(arguments,0),c=b.length,d=-1,g=d;while(++d<c){if(bd(b[d])){a=[];while(a[++g]=b[d][g]){}b[d]=a.length--&&a}else if(ba(b[d])){b[d]=b[d]}else if(b[d].constructor==v){b[d]=t.call(b[d]._(j),0)}else{b[d]=t.call(b[d],0)}}return E(this,I.apply(this._(j),b),{'callerName':'concat','callerArgs':arguments})};h.item=function(a){return a>-1&&a<this.length?this[a]:null};h.requery=function(){var a=this._(j,'data'),b=this.length,c=this.parentNodeList,d=a.snapshot;if(d){if(d.length!=b){a.snapshot=false}else{while(b--){if(this[b]!=d[b]){a.snapshot=false;break}}}}return a.snapshot?this[a.callerName].apply(c&&c.requery()||this,a.callerArgs||[]):this.slice(0)};h.reverse=function(){return B(this,this.length>0?z(bq.call(this)):u(),{'callerName':'reverse'})};h.secure=function(){var a=this,b=a,c=a.length;if(a._(j)==a){b=v();while(c--)b[c]=null;b.parentNodeList=null;b._=a._}return b};h.slice=function(a,b){var c=this._(j),d=b==null?t.call(c,a):t.call(c,a,b);return B(this,o?d:z(d),{'callerName':'slice','callerArgs':[a,b]})};h.splice=function(a,b){var c,d=this._(j,'data');if(d.self!=this){throw new Error(L);}d.snapshot=false;return E(null,c=br.apply(d.self,Z(arguments,2)),{'callerName':'createNodeList','callerArgs':[c]},true)};h.toArray=function(){return bk.call(this,0)};G(h,'querySelectorAll,queryScopedSelectorAll',function(m){return function(a){var b,c=-1,d=this._(j),g=d.length,f=[];while(++c<g){if(c in d&&(b=d[c][m](a)).length)Y(f,b)}return E(this,f,{'callerName':m,'callerArgs':[a]},true)}});G(h,'addEventListener,removeEventListener,dispatchEvent',function(m){return function(a,b,c){var d=this._(j),g=d.length,f=-1;if(b){while(++f<g)f in d&&d[f][m](a,b,c)}else{while(++f<g)f in d&&d[f][m](a)}return this}});G(h,'push,unshift',function(b){var c=h[b];return function(){var a=this._(j,'data');if(a.self!=this){throw new Error(L);}a.snapshot=false;return c.apply(this,Z(arguments))}});G(h,'pop,shift',function(b){var c=h[b];return function(){var a=this._(j,'data');if(a.self!=this)throw new Error(L);a.snapshot=false;return c.call(this)}});if(D(h.filter)){h.filter=function(c,d){var g,f=c,m=this._(j),r=this;if(m!=r){c=function(a,b){return f.call(this,null,b,r)};if(typeof f!='function'){throw new TypeError;}}g=bs.call(m,c,d);return B(this,o?g:z(g),{'callerName':'filter','callerArgs':[c,d]})}}if(D(h.indexOf)){h.indexOf=function(a){return bf.call(this._(j),a)}}if(D(h.lastIndexOf)){h.lastIndexOf=function(a){return bo.call(this._(j),a)}}if(D(h.map)){h.map=function(a,b){return E(this,bt.call(this,a,b),{'callerName':'map','callerArgs':[a,b]})}}if(T){h.filterSelector=function(a){var b=this._(j),c=-1,d=c,g=b.length,f=u();while(++c<g){if(c in b&&b[c][T]())f[++d]=b[c]}return B(this,f,{'callerName':'filterSelector','callerArgs':[a]})};h.matchesSelector=function(a){var b=this._(j),c=b.length,d=-1;while(++d<c){if(d in b&&b[d][T]())return true}return false}}(u.prototype=h).constructor=u;return N(u)},E=function(a,b,c,d){var g,f,m,r,q,p=v(),o=[],h=[],n=-1,I=n,bf=n;c||(c={});if(d){while(p[++n]=h[n]=b[n]){}p.length=--h.length;c.snapshot=h}else if(b){if(b.constructor==v){b=b.toArray()}m=b.length>>>0;while(++n<m){if(bm(node=b[n])){if(x(node)){if((f=y.call(h,root=bl(node)))<0){o[f=h.push(root)-1]=[]}}else{if((f=g)==null){o[f=g=h.push(i)-1]=[]}}if(y.call(o[f],node)<0){o[f].push(node)}}}m=o.length;while(++I<m){Y(p,S(o[I]))}}if(a&&a.constructor==v){p=B(a,p,c)}else{X(p,c);p.parentNodeList=null}return p},V=function V(a){var b=bd(a);if(arguments.length>0&&(!a||typeof a!='object'&&!b)){throw new Error('Incorrect argument: '+a+' '+typeof a);}return E(this,a,{'callerName':'createNodeList','callerArgs':[a]},b)},U=function(){var a,b,c,d,g,f;switch(J){case A:return l;case F:f=new ActiveXObject('htmlfile');f.write('<script><\/script>');f.close();w.push(f);if(k(l,'attachEvent')){l.attachEvent('onunload',function(){w.length=0})}return f.parentWindow;case K:b='/* fusebox_iframe_cache_fix */';c=j+bi++;d=i.body||M;try{a=i.createElement('<iframe name="'+c+'">')}catch(e){(a=i.createElement('iframe')).name=c}try{if('MozOpacity'in M.style&&k(l,'sessionStorage')&&!l.sessionStorage[b]){l.sessionStorage[b]=1;throw new Error;}a.style.display='none';d.insertBefore(a,d.firstChild);g=l.frames[c];f=g.document;f.write('<script>var g=this,c=function(s){(s=g.frameElement.src)&&g.location.replace(s);if(g.parent.document.readyState!="complete"){g.setTimeout(c,10)}};c()<\/script>');f.close();w.push(a);return g}catch(e){if(Q){s(F);return U()}if(R){s(A);return U()}throw new Error('Fusebox failed to create a sandbox by iframe.');}}throw new Error('Fusebox failed to create a sandbox.');};if(k(i,'createNodeList')){return}if(typeof i.readyState!='string'&&k(i,'addEventListener')){i.readyState='loading';i.addEventListener('DOMContentLoaded',function(){i.readyState='interactive'},true);l.addEventListener('load',function(){i.readyState='complete'},true)}if(Q&&!k(l,'XMLHttpRequest')&&l.location&&l.location.protocol=='https:'){s(F)}else if(bn){s(K)}else if(R){s(A)}v=be();i.createNodeList=V})(this);