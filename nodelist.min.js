/*  "Unofficial" NodeList API Implementation
 *  (c) 2010 John-David Dalton <john@fusejs.com>
 *  John Resig's site: http://nodelist.org/
 *
 *  Fuse JavaScript framework, version Alpha
 *  (c) 2008-2010 John-David Dalton
 *  http://www.fusejs.com/
 *
 *  Both "Unofficial" NodeList and FuseJS are released under the MIT license.
 */
(function(l,bh){var v,J,F=1,A=2,K=3,W=function(a){return a},L='NodeList is not mutable.',bi={'boolean':1,'number':1,'string':1,'undefined':1},w=[],bj=1,i=l.document,M=i.documentElement,N=W,bk=/(?:NodeList|HTMLCollection|Object)/,bl=[].slice,O={}.toString,j='uid'+(new Date).getTime(),X=function(g,f){f||(f={});f.data=f;f.self=g;g._=function(a,b,c){var d=null;if(a===j){d=f.self;if(b){if(c!==bh){f[b]=c}else{d=f[b]}}}return d}},G=function(a,b,c){var d=b.split(',');while(b=d.shift()){if(k(i,b)||typeof Array.prototype[b]=='function'){a[b]=c(b)}}},B=function(a,b,c){var d=a._(j,'data');c.requeryable=d.requeryable;b._||X(b,c);if(d.self!=a){b=b.secure()}b.parentNodeList=a;return b},Y=function(a,b){var c=a.length,d=b.length;while(d--)a[c+d]=b[d];return a},C=function(c,d){C=function(a,b){while(b=b[H]){if(b==a)return true}return false};var g=i.createElement('div');if(k(g,'contains')&&g.appendChild(g.cloneNode(g,false))&&g.appendChild(g.cloneNode(g,true))&&!g.firstChild.contains(g.childNodes[1].firstChild)){var f=C;C=function(a,b){return a.nodeName>'@'?a!=b&&a.contains(b):f(a,b)}}return C(c,d)},Z=function(a,b){var c=[],d=a.length,g=--b||-1,f=g;while(++g<d){if(ba(a[g])){c[++f]=a[g]}}return c},bb=function(a,b){var c=-1;b||(b=[]);while(b[++c]=a[c]){}return b.length--&&b},bm=function(a){var b;if(x(a)){do{if(!(b=a[H])){return a}}while(a=b)}return i},y=function(c){y=[].indexOf;if(typeof y!='function'){y=function(a){var b=this.length;while(b--){if(this[b]===a)return b}return-1}}return y(c)},x=function(b){if(bc){x=function(a){return(i.compareDocumentPosition(a)&1)==1}}else if(bd){x=function(a){return a.ownerDocument.all[a.sourceIndex]!=a}}else{x=function(a){return!(a[H]&&C(a.ownerDocument,a))}}return x(b)},D=function(a){return O.call(a)=='[object Function]'},k=function k(a,b){var c=typeof a[b];return c=='object'?!!a[b]:!bi[c]},ba=function(a){return a&&(!O.call(a).indexOf('[object HTML')||typeof a.nodeType=='number')},be=function(a){return a&&bk.test(O.call(a))&&'item'in a},bn=function(a){return a&&(a.nodeName>'@'||a.nodeType==3)&&a.ownerDocument==i},P=function(c){N=P=function(a){var b=w[w.length-1];b.parentNode.removeChild(b);return a};P(c);if(c().constructor==l.Array){if(Q){s(F)}else if(R){s(A)}w.pop();return bf()}return c},s=function(a){N=(J=a)==K?P:W},S=function(q){var n=function(a,b){while(b=b.previousSibling){if(b==a)return-1}return 1},h=function(a){var b,c,d,g,f,m,r=[],o=-1;while(a){++o;d=a[H];while(a=a.previousSibling){++o;g=-1;b=a.childNodes;while((r=[b[++g]])[0]){while(r.length){f=-1;c=[];while(descendant=r[++f]){++o;m=-1;descendants=descendant.childNodes;while(descendant=descendants[++m]){c.push(descendant)}}r=c}}}a=d}return o},p=function(a,b){return h(b)<h(a)?1:-1};if(bc){p=function(a,b){return a.compareDocumentPosition(b)&2?1:-1}}else if(bd){p=function(a,b){var c=a.nodeType==1,d=b.nodeType==1,g=(c?a:a.parentNode).sourceIndex,f=(d?b:b.parentNode).sourceIndex;if(c&&d){return f<g?1:-1}if(c&&!d){return f<g?n(a,b):-1}if(!c&&d){return g<f?-1*n(b,a):1}if(g!=f){return f<g?1:-1}return n(a,b)}}S=function(a){a.sort(p);return a};return S(q)},Q=!!(function(){try{return new ActiveXObject('htmlfile')}catch(e){}})(),bc=k(i,'compareDocumentPosition'),bo=k(i,'createElement')&&k(l,'frames')&&'src'in i.createElement('iframe'),R=(function(){var a,b=[],c=b['__proto__'];if(b['__proto__']==Array.prototype){b['__proto__']={};a=typeof b.push=='undefined';b['__proto__']=c}return!!a&&D(b.push)})(),bd=(function(a){return k(i,'all')&&typeof(a=i.createElement('div')).sourceIndex=='number'&&a.appendChild(a.cloneNode(false)).sourceIndex>-1})(),T=k(i,'matchesSelectors')&&'matchesSelectors'||k(i,'mozMatchesSelector')&&'mozMatchesSelector'||k(i,'msieMatchesSelector')&&'msieMatchesSelector'||k(i,'webkitMatchesSelector')&&'webkitMatchesSelector',H=k('parentElement',M)?'parentElement':'parentNode',bf=function(){var o=U(),q=J==A,n=o.Array().constructor!=l.Array,h=q&&new o.Array||o.Array.prototype,p=o.Array,I=h.concat,bg=h.indexOf,bp=h.lastIndexOf,bq=h.push,br=h.reverse,t=h.slice,bs=h.splice,bt=h.filter,bu=l.Array().map,u=function(a){var b=arguments.length;if(b){return b==1&&typeof a=='number'?new p(a):z(arguments)}return new p},z=function(a){var b=new p;bq.apply(b,a);return b};if(n){u=p;z=function(a){return t.call(a,0)}}else if(q){u=function(a){var b=[],c=arguments.length;if(c){if(c==1&&typeof a=='number'){b.length=a}else{b.push.apply(b,arguments)}}b.__proto__=h;return b};z=function(a){var b=t.call(a,0);b['__proto__']=h;return b}}h.createNodeList=V;h.concat=function(){var a=t.call(arguments,0),b=a.length,c=-1;while(++c<b){if(be(a[c])){a[c]=bb(a[c])}else if(ba(a[c])){a[c]=a[c]}else if(a[c].constructor==v){a[c]=t.call(a[c]._(j),0)}else{a[c]=t.call(a[c],0)}}return E(this,I.apply(this._(j),a),{'callerName':'concat','callerArgs':arguments})};h.item=function(a){return a>-1&&a<this.length?this[a]:null};h.requery=function(){var a=this._(j,'data'),b=this.parentNodeList;return a.requeryable?this[a.callerName].apply(b&&b.requery()||this,a.callerArgs||[]):this.slice(0)};h.reverse=function(){return B(this,this.length>0?z(br.call(this)):u(),{'callerName':'reverse'})};h.secure=function(){var a=this,b=a,c=a.length;if(a._(j)==a){b=v();while(c--)b[c]=null;b.parentNodeList=null;b._=a._}return b};h.slice=function(a,b){var c=this._(j),d=b==null?t.call(c,a):t.call(c,a,b);return B(this,n?d:z(d),{'callerName':'slice','callerArgs':[a,b]})};h.splice=function(a,b){var c,d=this._(j,'data');if(d.self!=this){throw new Error(L);}d.requeryable=false;return E(null,c=bs.apply(d.self,Z(arguments,2)),{'callerName':'createNodeList','callerArgs':[c]},true)};h.toArray=function(){return bl.call(this,0)};G(h,'querySelectorAll,queryScopedSelectorAll',function(m){return function(a){var b,c=-1,d=this._(j),g=d.length,f=[];while(++c<g){if(c in d&&(b=d[c][m](a)).length)Y(f,b)}return E(this,f,{'callerName':m,'callerArgs':[a]},true)}});G(h,'addEventListener,removeEventListener,dispatchEvent',function(m){return function(a,b,c){var d=this._(j),g=d.length,f=-1;if(b){while(++f<g)f in d&&d[f][m](a,b,c)}else{while(++f<g)f in d&&d[f][m](a)}return this}});G(h,'push,unshift',function(b){var c=h[b];return function(){var a=this._(j,'data');if(a.self!=this){throw new Error(L);}a.requeryable=false;return c.apply(this,Z(arguments))}});G(h,'pop,shift',function(b){var c=h[b];return function(){var a=this._(j,'data');if(a.self!=this)throw new Error(L);a.requeryable=false;return c.call(this)}});if(D(h.filter)){h.filter=function(c,d){var g,f=c,m=this._(j),r=this;if(m!=r){c=function(a,b){return f.call(this,null,b,r)};if(typeof f!='function'){throw new TypeError;}}g=bt.call(m,c,d);return B(this,n?g:z(g),{'callerName':'filter','callerArgs':[c,d]})}}if(D(h.indexOf)){h.indexOf=function(a){return bg.call(this._(j),a)}}if(D(h.lastIndexOf)){h.lastIndexOf=function(a){return bp.call(this._(j),a)}}if(D(h.map)){h.map=function(a,b){return E(this,bu.call(this,a,b),{'callerName':'map','callerArgs':[a,b]})}}if(T){h.filterSelector=function(a){var b=this._(j),c=-1,d=c,g=b.length,f=u();while(++c<g){if(c in b&&b[c][T]())f[++d]=b[c]}return B(this,f,{'callerName':'filterSelector','callerArgs':[a]})};h.matchesSelector=function(a){var b=this._(j),c=b.length,d=-1;while(++d<c){if(d in b&&b[d][T]())return true}return false}}(u.prototype=h).constructor=u;return N(u)},E=function(a,b,c,d){var g,f,m,r,o,q=v(),n=[],h=[],p=-1,I=p,bg=p;c||(c={});if(d){bb(b,q);c.requeryable=true}else if(b){if(b.constructor==v&&b._){o=b._(j,'data');c.requeryable=o.requeryable;b=o.self.toArray()}else{c.requeryable=false}m=b.length>>>0;while(++p<m){if(bn(node=b[p])){if(x(node)){if((f=y.call(h,root=bm(node)))<0){n[f=h.push(root)-1]=[]}}else{if((f=g)==null){n[f=g=h.push(i)-1]=[]}}if(y.call(n[f],node)<0){n[f].push(node)}}}m=n.length;while(++I<m){Y(q,S(n[I]))}}if(a&&a.constructor==v){q=B(a,q,c)}else{X(q,c);q.parentNodeList=null}return q},V=function V(a){var b=be(a);if(arguments.length>0&&(!a||typeof a!='object'&&!b)){throw new Error('Incorrect argument: '+a+' '+typeof a);}return E(this,a,{'callerName':'createNodeList','callerArgs':[a]},b)},U=function(){var a,b,c,d,g,f;switch(J){case A:return l;case F:f=new ActiveXObject('htmlfile');f.write('<script><\/script>');f.close();w.push(f);if(k(l,'attachEvent')){l.attachEvent('onunload',function(){w.length=0})}return f.parentWindow;case K:b='/* fusebox_iframe_cache_fix */';c=j+bj++;d=i.body||M;try{a=i.createElement('<iframe name="'+c+'">')}catch(e){(a=i.createElement('iframe')).name=c}try{if('MozOpacity'in M.style&&k(l,'sessionStorage')&&!l.sessionStorage[b]){l.sessionStorage[b]=1;throw new Error;}a.style.display='none';d.insertBefore(a,d.firstChild);g=l.frames[c];f=g.document;f.write('<script>var g=this,c=function(s){(s=g.frameElement.src)&&g.location.replace(s);if(g.parent.document.readyState!="complete"){g.setTimeout(c,10)}};c()<\/script>');f.close();w.push(a);return g}catch(e){if(Q){s(F);return U()}if(R){s(A);return U()}throw new Error('Fusebox failed to create a sandbox by iframe.');}}throw new Error('Fusebox failed to create a sandbox.');};if(k(i,'createNodeList')){return}if(typeof i.readyState!='string'&&k(i,'addEventListener')){i.readyState='loading';i.addEventListener('DOMContentLoaded',function(){i.readyState='interactive'},true);l.addEventListener('load',function(){i.readyState='complete'},true)}if(Q&&!k(l,'XMLHttpRequest')&&l.location&&l.location.protocol=='https:'){s(F)}else if(bo){s(K)}else if(R){s(A)}v=bf();i.createNodeList=V})(this);